"use strict";var TrafficMap={json:void 0,map:{},lat:59.3,"long":15,icons:{},selection:"4",markers:[],markersGroup:L.layerGroup(this.markers),options:["Vägtrafik","Kollektivtrafik","Planerad störning","Övrigt"],init:function(){TrafficMap.getJson(),TrafficMap.renderList(),TrafficMap.map=L.map("map",{center:[TrafficMap.lat,TrafficMap["long"]],minZoom:4,zoom:7}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(TrafficMap.getPosition),L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright" title="OpenStreetMap" target="_blank">OpenStreetMap</a> contributors | Tiles Courtesy of <a href="http://www.mapquest.com/" title="MapQuest" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" width="16" height="16">',subdomains:["otile1","otile2","otile3","otile4"]}).addTo(TrafficMap.map);for(var e=document.getElementsByClassName("category-a"),t=0;t<e.length;t++)e[t].onclick=function(){return TrafficMap.selection=this.getAttribute("value"),TrafficMap.renderMarkers(),TrafficMap.renderList(),!1};TrafficMap.createMarkerIcons(),TrafficMap.renderMarkers()},getJson:function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&(TrafficMap.json=JSON.parse(e.responseText))},e.open("GET","Resources/trafficMessages.json",!1),e.send(null)},renderMarkers:function(){TrafficMap.markers.forEach(function(e){TrafficMap.map.removeLayer(e)}),TrafficMap.markers=[];for(var e=TrafficMap.json.messages,t=0;t<e.length;t++){var a=e[t].category,r=e[t].priority;if(TrafficMap.selection==a||"4"==TrafficMap.selection){var i=L.marker([e[t].latitude,e[t].longitude],{icon:TrafficMap.icons[a+""+r]}).addTo(TrafficMap.map);i.bindPopup(TrafficMap.renderListItemContent(e[t])),TrafficMap.markers.push(i)}}},setOnclicks:function(){for(var e=document.getElementsByClassName("message-anchor"),t=0;t<e.length;t++)e[t].onclick=function(){var e=this.getAttribute("value");return e=e.split(", ",2),TrafficMap.map.setView([e[0],e[1]],10),TrafficMap.markers.forEach(function(t){t.getLatLng().lat==e[0]&&t.getLatLng().lng==e[1]&&(t.openPopup(),document.getElementById("map").scrollIntoView())}),!1}},renderList:function(){var e=document.getElementById("traffic-messages"),t=document.getElementById("traffic-messages-list");null===t?(t=document.createElement("div"),t.setAttribute("id","traffic-messages-list")):t.innerHTML="";var a=document.createElement("ul");a.setAttribute("class","messages-list");for(var r=TrafficMap.json.messages,i=0,s=0;s<r.length;s++)if(TrafficMap.selection==r[s].category||"4"==TrafficMap.selection){i++;var n=document.createElement("a");n.setAttribute("class","message-anchor"),n.setAttribute("href","#"),n.setAttribute("value",r[s].latitude+", "+r[s].longitude);var o=document.createElement("li"),c=TrafficMap.renderListItemContent(r[s]);o.appendChild(c),n.appendChild(o),a.appendChild(n)}if(0==i){var p=document.createElement("p");p.setAttribute("class","no-mess"),p.innerHTML="Det finns inga meddelanden att visa.",e.appendChild(p)}else t.appendChild(a),e.appendChild(t);TrafficMap.setOnclicks()},renderListItemContent:function(e){var t=document.createElement("div"),a=document.createElement("h3");a.innerHTML=e.title;var r=document.createElement("p");r.setAttribute("class","date"),r.innerHTML=TrafficMap.formatDate(e.createddate);var i=document.createElement("p");i.setAttribute("class","category"),i.innerHTML=TrafficMap.options[e.category];var s=document.createElement("p");return""!=e.description?s.innerHTML=e.description:s.innerHTML="Beskrivning saknas.",t.appendChild(a),t.appendChild(r),t.appendChild(i),t.appendChild(s),t},formatDate:function(e){e=parseInt(e,10),e=new Date(e);var t=e.getFullYear(),a=TrafficMap.addZeroToDate(e.getMonth()+1),r=TrafficMap.addZeroToDate(e.getDate()),i=TrafficMap.addZeroToDate(e.getHours()),s=TrafficMap.addZeroToDate(e.getMinutes()),n=TrafficMap.addZeroToDate(e.getSeconds());return t+"-"+a+"-"+r+", "+i+"."+s+"."+n+" "},addZeroToDate:function(e){return 10>e&&(e="0"+e),e},getPosition:function(e){TrafficMap.lat=e.coords.latitude,TrafficMap["long"]=e.coords.longitude,TrafficMap.map.setView([TrafficMap.lat,TrafficMap["long"]],10)},createMarkerIcons:function(){var e=L.Icon.extend({options:{shadowUrl:"Content/css/images/shadow.svg",iconSize:[30,35],shadowSize:[30,32],iconAnchor:[15,33],shadowAnchor:[10,30],popupAnchor:[0,-25]}}),t=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 0, 31, 35))"}),a=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 40, 31, 35))"}),r=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 80, 31, 35))"}),i=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 120, 31, 35))"}),s=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 160, 31, 35))"}),n=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 200, 31, 35))"}),o=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 240, 31, 35))"}),c=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 280, 31, 35))"}),p=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 320, 31, 35))"}),f=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 360, 31, 35))"}),g=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 400, 31, 35))"}),l=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 440, 31, 35))"}),m=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 480, 31, 35))"}),d=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 520, 31, 35))"}),v=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 560, 31, 35))"}),u=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 600, 31, 35))"}),w=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 640, 31, 35))"}),M=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 680, 31, 35))"}),T=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 720, 31, 35))"}),k=new e({iconUrl:"Content/css/images/markers-sprite.svg#svgView(viewBox(0, 760, 31, 35))"});TrafficMap.icons={"01":t,"02":a,"03":r,"04":i,"05":s,11:n,12:o,13:c,14:p,15:f,21:g,22:l,23:m,24:d,25:v,31:u,32:w,33:M,34:T,35:k}}};window.onload=TrafficMap.init;
